// SPDX-License-Identifier: (GPL-2.0 OR MIT)
//
// Copyright (C) 2022 Prodrive Technologies

/*
 * Building block definitions which are applicable to all variants of the i.MX8M building blocks.
 */

/ {
	chosen {
		stdout-path = &uart4;
	};

	aliases {
		rtc1 = &snvs_rtc;
		/*
		 * When U-Boot environment variable 'ethaddr' is set, the MAC address from the i.MX eFuses gets overwritten.
		 * 'ethaddr' is a magic environment variable in U-Boot and related to the ethernet alias described in the device tree.
		 * By deleting the ethernet alias property, the MAC address cannot be spoofed by setting the 'ethaddr' variable.
		 * Allow setting MAC address values by U-Boot by adding the ethernet alias to the product device tree.
		 */
		/delete-property/ ethernet0;
	};
};

&A53_0 {
	cpu-supply = <&arm_core_voltage_regulator>;
};

&snvs_pwrkey {
	status = "okay";
};

/*
	The following definitions list the parts and interfaces which are placed on the building block itself.
	These parts and interfaces are enabled by default, as they are always available and used.
*/
imx8m_bb_uart_debug: &uart4 { /* Debug UART */
	pinctrl-names = "default";
	pinctrl-0 = <&imx8m_pinctrl_uart4>;
	status = "okay";
};

imx8m_bb_watchdog: &wdog1 {
	pinctrl-names = "default";
	//TODO: pinctrl for WDOG <-> PMIC triggering
	status = "okay";
	timeout-sec = <120>;
};

/* boot flash */
imx8m_bb_ecspi1: &ecspi1 {
	#address-cells = <1>;
	#size-cells = <0>;
	pinctrl-names = "default";
	pinctrl-0 = <&imx8m_pinctrl_ecspi1>;
	num-cs = <2>;
	cs-gpios =<0
		&gpio5 9 GPIO_ACTIVE_LOW>;
	status = "okay";

	imx8m_bb_spi_flash: flash@1 {
		reg = <1>;
		compatible = "jedec,spi-nor";
		spi-max-frequency = <12500000>;
		#address-cells = <1>;
		#size-cells = <1>;
		partition@0x00000000 {
			label = "recovery_boot";
			reg = <0x00000000 0x00400000>;
		};
		partition@0x00400000 {
			label = "boot_env";
			reg = <0x00400000 0x00020000>;
		};
		partition@0x00420000 {
			label = "factory_data";
			reg = <0x00420000 0x00020000>;
			read-only;
		};
		partition@0x00440000 {
			label = "customer_data";
			reg = <0x00440000 0x003C0000>;
		};
	};
};

/* eMMC */
imx8m_bb_emmc: &usdhc1 {
	pinctrl-names = "default";
	pinctrl-0 = <&imx8m_pinctrl_usdhc1>;
	bus-width = <8>;
	non-removable;
	status = "okay";
	mmc-hs200-1_8v;
	mmc-hs400-1_8v;
	max-frequency = <200000000>;
};

imx8m_bb_i2c1: &i2c1 {
	clock-frequency = <350000>;
	pinctrl-names = "default";
	pinctrl-0 = <&imx8m_pinctrl_i2c1>;
	pinctrl-1 = <&imx8m_pinctrl_i2c1_gpio>;
	scl-gpios = <&gpio5 14 GPIO_ACTIVE_HIGH>;
	sda-gpios = <&gpio5 15 GPIO_ACTIVE_HIGH>;
	status = "okay";

	imx8m_bb_pmic: pca9450@25 {
		reg = <0x25>;
		compatible = "nxp,pca9450a";
		/* PMIC PCA9450 PMIC_nINT GPIO1_IO3 */
		pinctrl-0 = <&imx8m_pinctrl_pmic>;
		interrupt-parent = <&gpio1>;
		interrupts = <3 IRQ_TYPE_LEVEL_LOW>;

		regulators {
			imx8m_bb_pmic_buck1: buck1 {
				regulator-name = "buck1";
				regulator-min-microvolt = <600000>;
				regulator-max-microvolt = <2187500>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <3125>;
				nxp,dvs-run-voltage = <850000>;
				nxp,dvs-standby-voltage = <800000>;
			};

			arm_core_voltage_regulator: buck2 {
				regulator-compatible = "buck2";
				regulator-min-microvolt = <600000>;
				regulator-max-microvolt = <2187500>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <3125>;
			};

			imx8m_bb_pmic_buck3: buck3 {
				regulator-compatible = "buck3";
				regulator-min-microvolt = <600000>;
				regulator-max-microvolt = <2187500>;
				regulator-boot-on;
				regulator-always-on;
			};

			imx8m_bb_pmic_buck4: buck4 {
				regulator-compatible = "buck4";
				regulator-min-microvolt = <600000>;
				regulator-max-microvolt = <3400000>;
				regulator-boot-on;
				regulator-always-on;
			};

			imx8m_bb_pmic_buck5: buck5 {
				regulator-compatible = "buck5";
				regulator-min-microvolt = <600000>;
				regulator-max-microvolt = <3400000>;
				regulator-boot-on;
				regulator-always-on;
			};

			imx8m_bb_pmic_buck6: buck6 {
				regulator-compatible = "buck6";
				regulator-min-microvolt = <600000>;
				regulator-max-microvolt = <3400000>;
				regulator-boot-on;
				regulator-always-on;
			};

			imx8m_bb_pmic_ldo1: ldo1 {
				regulator-compatible = "ldo1";
				regulator-min-microvolt = <1600000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
				regulator-always-on;
			};

			imx8m_bb_pmic_ldo2: ldo2 {
				regulator-compatible = "ldo2";
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <1150000>;
				regulator-boot-on;
				regulator-always-on;
			};

			imx8m_bb_pmic_ldo3: ldo3 {
				regulator-compatible = "ldo3";
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
				regulator-always-on;
			};

			imx8m_bb_pmic_ldo4: ldo4 {
				regulator-compatible = "ldo4";
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
				regulator-always-on;
			};

			imx8m_bb_pmic_ldo5: ldo5 {
				regulator-compatible = "ldo5";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
			};
		};
	};
};

/* USB is enabled by default for production and debugging purposes. */
/* USB is always available on the building block. */
imx8m_bb_usbotg1: &usbotg1 {
	dr_mode = "otg";
	status = "okay";
	hnp-disable;
	srp-disable;
	adp-disable;
};
